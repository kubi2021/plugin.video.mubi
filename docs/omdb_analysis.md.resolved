# OMDB Performance Analysis (Session: 2025-12-10)

## 1. Statistics Summary

| Metric | Count | Percentage |
| :--- | :--- | :--- |
| **Total Titles Processed** | **414** | 100% |
| ✅ **Found Matches** | **360** | **87.0%** |
| ❌ **Failures** | **54** | **13.0%** |
| - *Timeouts* | 7 | 1.7% |
| - *Content Missing* | 47 | 11.3% |
| **Total API Requests** | 549 | (Avg 1.3 reqs/title) |

## 2. Failure Analysis

Based on log analysis and code inspection, the 54 failures fall into three categories:

### A. Network Timeouts (7 Failures)
*   **Cause:** The default `requests` timeout (10s) was reached.
*   **Observation:** The current [RetryStrategy](file:///Users/kubi/Documents/GitHub/plugin.video.mubi/repo/plugin_video_mubi/resources/lib/external_metadata/title_utils.py#125-190) **does not retry** on generic connection timeouts (only on specific HTTP error codes like 429/5xx).
*   **Result:** 7 titles failed purely due to transient network issues.

### B. Year Mismatch (Major Factor)
*   **Cause:** The search logic **always enforces the year** (`&y=YEAR`) if MUBI provides one.
*   **Observation:** MUBI metadata often differs from OMDB/IMDb by ±1 year (e.g., Festival Premiere vs. Theatrical Release).
*   **Code Evidence:** [omdb_provider.py](file:///Users/kubi/Documents/GitHub/plugin.video.mubi/repo/plugin_video_mubi/resources/lib/external_metadata/omdb_provider.py) does not attempt a fallback search *without* the year if the strict search fails.
*   **Impact:** Titles like `Breathless` (if year mismatch occurred) or others would be found without the year constraint.

### C. Title Normalization Issues
*   **Cause:** [TitleNormalizer](file:///Users/kubi/Documents/GitHub/plugin.video.mubi/repo/plugin_video_mubi/resources/lib/external_metadata/title_utils.py#13-123) removes "and/&" and collapses whitespace but leaves punctuation.
*   **Examples:**
    *   `...A Valparaíso` (Leading dots likely confused OMDB)
    *   `#21XOXO` (Hashtag might be problematic)
*   **Impact:** Minor punctuation differences prevent matches.

## 3. Recommendations

To improve the success rate from 87% to >95%, I recommend the following changes:

1.  **Implement Fallback Strategy** `[Priority: High]`
    *   If search with `Year` fails, automatically retry the search *without* the `Year` parameter.
    *   *Estimated Impact:* Would likely fix 20-30% of "Not Found" errors.

2.  **Retry on Timeouts** `[Priority: Medium]`
    *   Update [RetryStrategy](file:///Users/kubi/Documents/GitHub/plugin.video.mubi/repo/plugin_video_mubi/resources/lib/external_metadata/title_utils.py#125-190) to catch `requests.exceptions.ReadTimeout` and `ConnectTimeout` and retry them.
    *   *Estimated Impact:* Would have saved 7 failures yesterday.

3.  **Enhance Title Normalization** `[Priority: Low]`
    *   Strip leading/trailing punctuation (`.`, `,`, `#`) in [TitleNormalizer](file:///Users/kubi/Documents/GitHub/plugin.video.mubi/repo/plugin_video_mubi/resources/lib/external_metadata/title_utils.py#13-123).
    *   *Estimated Impact:* Fixes edge cases like `...A Valparaíso`.

4.  **Filter Non-Movies**
    *   Detect "MV" (Music Video) or known short film indicators and either skip or adjust `media_type` if possible (OMDB defaults to movie).
