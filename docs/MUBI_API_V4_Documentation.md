# MUBI API v4 Technical Documentation

*This documentation was generated by AI based on analysis of the MUBI Kodi addon source code.*

## Overview

This document describes the MUBI API v4 endpoints used in the Kodi addon for streaming content from MUBI. The API base URL is `https://api.mubi.com/v4/`.

## Authentication

The API uses Bearer token authentication. Tokens are obtained through the device linking process.

### Headers

**Standard Web Headers (`heaGen()`)**:
- `Authorization`: Bearer token
- `Client`: web
- `Client-Country`: User's country code
- `Client-Accept-Audio-Codecs`: eac3,aac
- `Client-Accept-Video-Codecs`: h265,vp9,h264
- `User-Agent`: Browser user agent
- `accept-language`: User's language preference

**Android TV Headers (`heaATVGen()`)**:
- `client`: android_tv
- `client-version`: 36.1
- `client-device-identifier`: Device ID
- `client-country`: User's country code
- `User-Agent`: okhttp/4.10.1

## Authentication Endpoints

### Get Link Code
**Endpoint**: `GET /link_code`  
**Headers**: Android TV headers  
**Parameters**: None  
**Returns**: 
```json
{
  "auth_token": "string",
  "link_code": "string"
}
```

### Authenticate Device
**Endpoint**: `POST /authenticate`  
**Headers**: Android TV headers  
**Body**: 
```json
{
  "auth_token": "string"
}
```
**Returns**:
```json
{
  "token": "string",
  "user": {
    "id": "integer"
  }
}
```

### Logout
**Endpoint**: `DELETE /sessions`  
**Headers**: Android TV headers + Authorization  
**Returns**: HTTP 200 on success

## Content Discovery

### Browse Films
**Endpoint**: `GET /browse/films`  
**Headers**: Standard web headers  
**Parameters**:
- `sort`: Sorting method
- `playable`: "true" to show only playable content
- `page`: Page number for pagination
- Additional filter parameters

**Returns**:
```json
{
  "films": [
    {
      "id": "integer",
      "title": "string",
      "year": "integer",
      "duration": "integer",
      "rating": "float",
      "plot": "string",
      "image_url": "string",
      "trailer_url": "string"
    }
  ],
  "meta": {
    "next_page": "integer|null"
  }
}
```

### Browse Collections
**Endpoint**: `GET /browse/film_groups`  
**Headers**: Standard web headers  
**Parameters**:
- `sort`: Sorting method
- `page`: Page number

**Returns**:
```json
{
  "film_groups": [
    {
      "id": "integer",
      "title": "string",
      "full_title": "string",
      "description": "string",
      "image": "string"
    }
  ],
  "meta": {
    "next_page": "integer|null"
  }
}
```

### Browse Cast & Crew
**Endpoint**: `GET /browse/cast_members`  
**Headers**: Standard web headers  
**Parameters**:
- `page`: Page number
- Additional filter parameters

**Returns**:
```json
{
  "cast_members": [
    {
      "id": "integer",
      "name": "string",
      "slug": "string",
      "primary_type": "string",
      "image_url": "string"
    }
  ],
  "meta": {
    "next_page": "integer|null"
  }
}
```

### Browse Lists
**Endpoint**: `GET /browse/lists`  
**Headers**: Standard web headers  
**Parameters**:
- `sort`: Sorting method
- `page`: Page number

**Returns**:
```json
{
  "lists": [
    {
      "title": "string",
      "slug": "string",
      "description": "string",
      "fan_count": "integer",
      "film_count": "integer",
      "thumbnails": [
        {
          "src": "string"
        }
      ]
    }
  ],
  "meta": {
    "next_page": "integer|null"
  }
}
```

### Browse Industry Events
**Endpoint**: `GET /browse/industry_events`  
**Headers**: Standard web headers  
**Parameters**:
- `sort`: Sorting method
- `page`: Page number
- Additional filter parameters

**Returns**:
```json
{
  "industry_events": [
    {
      "id": "integer",
      "name": "string",
      "slug": "string",
      "white_logo_url": "string"
    }
  ],
  "meta": {
    "next_page": "integer|null"
  }
}
```

## Content Details

### Collection Items
**Endpoint**: `GET /film_groups/{id}/film_group_items`  
**Headers**: Standard web headers  
**Parameters**:
- `include_upcoming`: "true"
- `page`: Page number
- `per_page`: Items per page (24)

**Returns**:
```json
{
  "film_group_items": [
    {
      "film": {
        "id": "integer",
        "title": "string"
      }
    }
  ],
  "meta": {
    "next_page": "integer|null"
  }
}
```

### Cast Member Details
**Endpoint**: `GET /cast_members/{slug}`  
**Headers**: Standard web headers  
**Returns**:
```json
{
  "name": "string",
  "image_url": "string",
  "credits": [
    {
      "credit": "string",
      "type": "string"
    }
  ]
}
```

### Cast Member Films
**Endpoint**: `GET /cast_members/{id}/films`  
**Headers**: Standard web headers  
**Parameters**:
- `page`: Page number
- `per_page`: Items per page (12)
- `cast_member_credit`: Credit type

### List Films
**Endpoint**: `GET /lists/{slug}/list_films`  
**Headers**: Standard web headers  
**Parameters**:
- `page`: Page number
- `per_page`: Items per page (48)

**Returns**:
```json
{
  "list_films": [
    {
      "film": {
        "id": "integer",
        "title": "string"
      }
    }
  ],
  "meta": {
    "next_page": "integer|null"
  }
}
```

### Industry Event Years
**Endpoint**: `GET /industry_events/{slug}/years`  
**Headers**: Standard web headers  
**Returns**: Array of year integers

### Industry Event Films
**Endpoint**: `GET /industry_events/{id}/films`  
**Headers**: Standard web headers  
**Parameters**:
- `year`: Filter by year
- `status`: Filter by status
- `page`: Page number

**Returns**:
```json
{
  "films": [
    {
      "id": "integer",
      "title": "string"
    }
  ],
  "meta": {
    "next_page": "integer|null"
  }
}
```

## Series Support

### Series Seasons
**Endpoint**: `GET /series/{id}/up_next`  
**Headers**: Standard web headers  
**Returns**:
```json
{
  "series": {
    "seasons": [
      {
        "title": "string",
        "slug": "string"
      }
    ]
  }
}
```

### Season Episodes
**Endpoint**: `GET /series/{id}/seasons/{season_slug}/episodes`  
**Headers**: Standard web headers  
**Parameters**:
- `page`: Page number

**Returns**:
```json
{
  "episodes": [
    {
      "id": "integer",
      "title": "string"
    }
  ],
  "meta": {
    "next_page": "integer|null"
  }
}
```

## Search

### Search Films
**Endpoint**: `GET /search/films`  
**Headers**: Standard web headers  
**Parameters**:
- `query`: URL-encoded search term
- `page`: Page number
- `per_page`: Items per page (24)
- `playable`: "true" (optional)

### Search Cast Members
**Endpoint**: `GET /search/cast_members`  
**Headers**: Standard web headers  
**Parameters**: Same as search films

## Playback

### Create Viewing Session
**Endpoint**: `POST /films/{id}/viewing`  
**Headers**: Standard web headers  
**Parameters**: `parental_lock_enabled=true`  
**Body**: `{}`

### Get Secure Stream URL
**Endpoint**: `GET /films/{id}/viewing/secure_url`  
**Headers**: Standard web headers  
**Returns**:
```json
{
  "url": "string",
  "drm_license_url": "string"
}
```

### Preroll Viewing
**Endpoint**: `POST /prerolls/viewings`  
**Headers**: Standard web headers  
**Body**:
```json
{
  "viewing_film_id": "integer"
}
```

### Film Language Options
**Endpoint**: `GET /films/{id}/playback_languages`  
**Headers**: Standard web headers  
**Returns**:
```json
{
  "audio_options": ["string"],
  "subtitle_options": ["string"],
  "media_features": ["string"]
}
```

## DRM Configuration

For protected content, the addon uses Widevine DRM with the following license server:
- **License URL**: `https://lic.drmtoday.com/license-proxy-widevine/cenc/`
- **Custom Data**: Base64 encoded JSON with userId, sessionId, and merchant

## Error Handling

API errors typically return:
```json
{
  "message": "string",
  "user_message": "string"
}
```

Common HTTP status codes:
- 200: Success
- 401: Unauthorized (invalid token)
- 404: Not found
- 500: Server error